<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sumaq Mikuy - Reservas</title>
  <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
  
  <!-- 
    ¡IMPORTANTE! 
    Este JS es nuevo y necesario para que funcionen las tarjetas de mesa.
  -->
  <script src="{{ url_for('static', filename='js/reservas.js') }}" defer></script>
</head>
<body class="bg-[#1f1a17] text-white scroll-smooth">

  <header class="bg-transparent px-6 py-3 fixed top-0 left-0 w-full z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <a href="{{ url_for('index') }}#inicio" class="flex items-center gap-2">
        <img src="{{ url_for('static', filename='icon/logo.png') }}" class="w-10 h-10">
        <span class="text-xl font-bold text-amber-100 hidden sm:block">Sumaq Mikuy</span>
      </a>
      <a href="{{ url_for('index') }}" class="text-amber-100 hover:underline">Inicio</a>
    </div>
  </header>

  <section class="min-h-screen flex flex-col items-center justify-start bg-gradient-to-b from-[#1f1a17] via-[#2f231b] to-[#4b321f] pt-28 px-4 pb-12">
    <div class="text-center mb-12">
      <h1 class="text-5xl font-serif font-bold text-amber-400 mb-4 animate-fade-in">Reserva tu mesa</h1>
      <p class="text-lg text-amber-100 max-w-2xl mx-auto animate-fade-in delay-200">
        Elige tu espacio y disfruta de una experiencia andina inolvidable.
      </p>
    </div>

    <!-- 
      ↓↓↓ CORRECCIÓN: El 'action' apunta a 'reservar_mesa'
    -->
    <form id="formReserva" method="POST" action="{{ url_for('reservar_mesa') }}" class="mt-4 bg-black/40 p-6 sm:p-8 rounded-2xl shadow-xl max-w-2xl w-full space-y-6 animate-fade-in delay-300">
      
      <!-- === SECCIÓN DATOS PERSONALES === -->
      <div>
        <h3 class="text-2xl font-bold text-amber-400">Datos Personales</h3>
        <p class="text-sm text-amber-200 mb-4">Estos datos se rellenan desde tu cuenta.</p>
        
        <!-- 
          ↓↓↓ MEJORA UX/UI: Inputs de solo lectura mejor estilizados 
          ↓↓↓ CORRECCIÓN: Nombres de campos ('apellidos', 'celular')
        -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="nombres" class="block text-sm font-medium text-amber-200 mb-1">Nombres</label>
            <input type="text" id="nombres" name="nombres" value="{{ usuario.nombres | default('') }}" readonly class="w-full px-4 py-3 rounded-lg bg-gray-700 text-gray-300 cursor-not-allowed">
          </div>
          <div>
            <label for="apellidos" class="block text-sm font-medium text-amber-200 mb-1">Apellidos</label>
            <input type="text" id="apellidos" name="apellidos" value="{{ usuario.apellidos | default('') }}" readonly class="w-full px-4 py-3 rounded-lg bg-gray-700 text-gray-300 cursor-not-allowed">
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-amber-200 mb-1">Correo Electrónico</label>
            <input type="email" id="email" name="email" value="{{ usuario.email | default('') }}" readonly class="w-full px-4 py-3 rounded-lg bg-gray-700 text-gray-300 cursor-not-allowed">
          </div>
          <div>
            <label for="celular" class="block text-sm font-medium text-amber-200 mb-1">Celular</label>
            <input type="text" name="celular" id="celular" value="{{ usuario.celular | default('') }}" readonly class="w-full px-4 py-3 rounded-lg bg-gray-700 text-gray-300 cursor-not-allowed">
          </div>
        </div>
      </div>

      <!-- === SECCIÓN SELECCIONAR MESA (MEJORADA) === -->
      <div>
        <h3 class="text-2xl font-bold text-amber-400 mt-4">Seleccionar Mesa</h3>
        
        <!-- 
          ↓↓↓ CORRECCIÓN: Input oculto para el ID de la mesa
        -->
        <input type="hidden" id="mesa_id" name="mesa_id" required>
        
        <!-- 
          ↓↓↓ MEJORA UX/UI: Falso 'select' que abre el contenedor de tarjetas
        -->
        <div class="relative mt-4">
            <input type="text" id="mesa_display" name="mesa_display" readonly required 
                   class="w-full pl-10 pr-4 py-3 rounded-lg bg-amber-50 text-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-500 cursor-pointer" 
                   placeholder="Haz clic para seleccionar una mesa">
            <!-- Icono -->
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M5 2a1 1 0 00-1 1v1H2.5A1.5 1.5 0 001 5.5V9a1 1 0 001 1h12a1 1 0 001-1V5.5A1.5 1.5 0 0013.5 4H12V3a1 1 0 00-1-1H5zM2 11v3.5A1.5 1.5 0 003.5 16h11a1.5 1.5 0 001.5-1.5V11H2z" />
                </svg>
            </span>
        </div>

        <!-- 
          ↓↓↓ MEJORA UX/UI: Contenedor de Tarjetas (el "dropdown")
        -->
        <div id="contenedorMesasContainer" class="hidden mt-2 bg-amber-50 p-4 rounded-lg">
          <h4 class="text-amber-800 font-medium mb-3">Selecciona una mesa disponible</h4>
          <!-- El JS poblará este grid -->
          <div id="contenedorMesas" 
               data-mesas-ocupadas='{{ mesas_ocupadas | default([]) | tojson }}'
               class="grid grid-cols-2 sm:grid-cols-3 gap-3 max-h-60 overflow-y-auto">
            
            <!-- El JS llenará esto. Ejemplo de tarjeta:
            <div class="mesa-card p-3 bg-white rounded-lg shadow cursor-pointer hover:bg-amber-100 text-gray-800" data-id="1" data-nombre="Mesa 1 (Interior)">
                <p class="font-bold">Mesa N° 1</p>
                <p class="text-sm text-gray-600">Capacidad: 4</p>
                <p class="text-sm text-gray-600">Ubicación: Interior</p>
            </div> 
            -->
          </div>
        </div>
      </div>
      
      <!-- === SECCIÓN DETALLES DE RESERVA === -->
      <div>
        <h3 class="text-2xl font-bold text-amber-400 mt-4">Detalles de Reserva</h3>
        <!-- 
          ↓↓↓ CORRECCIÓN: Nombres de campos (fecha_reserva, hora_reserva)
        -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
          <div>
            <label for="num_personas" class="block text-sm font-medium text-amber-200 mb-1">N° de Personas</label>
            <input type="number" id="num_personas" name="num_personas" min="1" max="12" value="2" required 
                   class="w-full px-4 py-3 rounded-lg bg-amber-50 text-black focus:outline-none focus:ring-2 focus:ring-amber-500">
          </div>
          <div>
            <label for="fecha_reserva" class="block text-sm font-medium text-amber-200 mb-1">Fecha</labe-l>
            <input type="date" id="fecha_reserva" name="fecha_reserva" required 
                   class="w-full px-4 py-3 rounded-lg bg-amber-50 text-black focus:outline-none focus:ring-2 focus:ring-amber-500">
          </div>
          <div>
            <label for="hora_reserva" class="block text-sm font-medium text-amber-200 mb-1">Hora</label>
            <input type="time" id="hora_reserva" name="hora_reserva" required 
                   class="w-full px-4 py-3 rounded-lg bg-amber-50 text-black focus:outline-none focus:ring-2 focus:ring-amber-500">
          </div>
        </div>
      </div>

      <!-- === SECCIÓN NOTAS ADICIONALES === -->
      <div>
        <h3 class="text-2xl font-bold text-amber-400 mt-4">Notas Adicionales</h3>
        <!-- 
          ↓↓↓ MEJORA UX/UI: Añadido campo de notas
        -->
        <textarea name="notas" id="notas" rows="3" 
                  class="w-full px-4 py-3 rounded-lg bg-amber-50 text-black focus:outline-none focus:ring-2 focus:ring-amber-500 mt-4"
                  placeholder="¿Alguna celebración especial, alergia o preferencia? (Opcional)"></textarea>
      </div>

      <!-- === SECCIÓN PLATOS (JS-driven) === -->
      <div>
        <h3 class="text-2xl font-bold text-amber-400 mt-4">Platos Seleccionados</h3>
        <p class="text-sm text-amber-200 mb-3">Estos son los platos que elegiste en el menú. Puedes volver y modificar tu selección.</p>
        
        <div id="listaPlatos" class="space-y-3 text-amber-100 text-sm bg-black/30 p-4 rounded-lg min-h-[50px]">
          <!-- El JS llenará esto desde localStorage -->
        </div>

        <a href="{{ url_for('menu') }}" class="inline-block w-full text-center bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-xl shadow-md transition mt-4">
          Ir al Menú para Añadir Platos
        </a>
      </div>

      <!-- === BOTÓN DE CONFIRMAR === -->
      <button type="submit" class="w-full bg-amber-600 hover:bg-amber-700 py-4 rounded-lg font-bold text-white text-lg transition shadow-lg mt-6">
        Confirmar Reserva
      </button>
    </form>
  </section>
</body>
</html>
